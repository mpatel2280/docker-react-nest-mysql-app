=======================================================================================================================
2025-12-11 08:36:36
=======================================================================================================================
# test result
docker exec nestjs-backend-dev npm run test:e2e

> react-nest-app@0.0.1 test:e2e
> jest --config ./test/jest-e2e.json

PASS test/app.e2e-spec.ts
  App (e2e)
    AppController
      ✓ / (GET) (37 ms)
    Authentication
      ✓ /users (POST) - should create a new user with password (327 ms)
      ✓ /auth/login (POST) - should login with valid credentials (90 ms)
      ✓ /auth/login (POST) - should fail with invalid password (82 ms)
      ✓ /auth/login (POST) - should fail with non-existent email (5 ms)
      ✓ /users (GET) - should return all users without passwords (9 ms)
      ✓ /users/:id (GET) - should return a user by id without password (6 ms)
      ✓ /users/:id (PATCH) - should update user with new password (334 ms)
      ✓ /users/:id (DELETE) - should delete a user (97 ms)

Test Suites: 1 passed, 1 total
Tests:       9 passed, 9 total
Snapshots:   0 total
Time:        2.452 s, estimated 4 s
Ran all test suites.


docker exec nestjs-backend-dev npm run test:cov

> react-nest-app@0.0.1 test:cov
> jest --coverage

PASS src/app.controller.spec.ts
PASS src/user/user.service.spec.ts
PASS src/auth/auth.service.spec.ts
PASS src/auth/auth.controller.spec.ts
---------------------|---------|----------|---------|---------|-------------------
File                 | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
---------------------|---------|----------|---------|---------|-------------------
All files            |   52.17 |     52.5 |    62.5 |   51.61 |                   
 src                 |   46.42 |       50 |      75 |    40.9 |                   
  app.controller.ts  |     100 |       75 |     100 |     100 | 6                 
  app.module.ts      |       0 |      100 |     100 |       0 | 1-13              
  app.service.ts     |     100 |      100 |     100 |     100 |                   
  main.ts            |       0 |        0 |       0 |       0 | 1-13              
 src/auth            |   76.66 |    81.25 |     100 |   79.16 |                   
  auth.controller.ts |     100 |       75 |     100 |     100 | 7-10              
  auth.module.ts     |       0 |      100 |     100 |       0 | 1-11              
  auth.service.ts    |     100 |     87.5 |     100 |     100 | 7                 
 src/auth/dto        |     100 |      100 |     100 |     100 |                   
  login.dto.ts       |     100 |      100 |     100 |     100 |                   
 src/prisma          |   41.66 |      100 |       0 |    37.5 |                   
  prisma.module.ts   |       0 |      100 |     100 |       0 | 1-9               
  prisma.service.ts  |   71.42 |      100 |       0 |      60 | 10-14             
 src/user            |   42.85 |    27.77 |   57.14 |   44.44 |                   
  user.controller.ts |       0 |        0 |       0 |       0 | 1-44              
  user.module.ts     |       0 |      100 |     100 |       0 | 1-10              
  user.service.ts    |     100 |    83.33 |     100 |     100 | 9                 
 src/user/dto        |       0 |      100 |     100 |       0 |                   
  create-user.dto.ts |       0 |      100 |     100 |       0 | 1                 
  update-user.dto.ts |       0 |      100 |     100 |       0 | 1                 
---------------------|---------|----------|---------|---------|-------------------

Test Suites: 4 passed, 4 total
Tests:       15 passed, 15 total
Snapshots:   0 total
Time:        6.819 s
Ran all test suites.

# auth module updated
curl -X POST http://localhost:3000/auth/login -H "Content-Type: application/json" -d '{"email":"m1@test.com","password":"changeme"}'
[3:23:03 AM] File change detected. Starting incremental compilation...

[3:23:03 AM] Found 0 errors. Watching for file changes.

[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [NestFactory] Starting Nest application...
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [InstanceLoader] PrismaModule dependencies initialized +17ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [InstanceLoader] AppModule dependencies initialized +1ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [InstanceLoader] AuthModule dependencies initialized +0ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [InstanceLoader] UserModule dependencies initialized +0ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [RoutesResolver] AppController {/}: +3ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [RouterExplorer] Mapped {/, GET} route +4ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [RoutesResolver] UserController {/users}: +0ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [RouterExplorer] Mapped {/users, POST} route +1ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [RouterExplorer] Mapped {/users, GET} route +2ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [RouterExplorer] Mapped {/users/:id, GET} route +2ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [RouterExplorer] Mapped {/users/:id, PATCH} route +1ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [RouterExplorer] Mapped {/users/:id, DELETE} route +1ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [RoutesResolver] AuthController {/auth}: +1ms
[Nest] 162  - 12/11/2025, 3:23:16 AM     LOG [RouterExplorer] Mapped {/auth/login, POST} route +0ms
[Nest] 162  - 12/11/2025, 3:23:21 AM     LOG [NestApplication] Nest application successfully started +4128ms
manish@manubantu:~/code/docker-react-nest-mysql-app$ 
manish@manubantu:~/code/docker-react-nest-mysql-app$ curl -X POST http://localhost:3000/auth/login -H "Content-Type: application/json" -d '{"email":"test@example.com","password":"changeme"}'
manish@manubantu:~/code/docker-react-nest-mysql-app$ curl -X POST http://localhost:3000/auth/login -H "Content-Type: application/json" -d '{"email":"m1@test.com","password":"123456"}'
{"message":"Invalid credentials","error":"Unauthorized","statusCode":401}manish@manubantu:~/code/docker-react-nest-mysql-app$ 
manish@manubantu:~/code/docker-react-nest-mysql-app$ curl -s http://localhost:3000/users
[{"id":1,"email":"m1@test.com","name":"Manish","createdAt":"2025-12-10T17:25:47.000Z","updatedAt":"2025-12-10T17:25:47.000Z"},{"id":3,"email":"admin2@admin.cm","name":"Admin2","createdAt":"2025-12-10T17:27:29.009Z","updatedAt":"2025-12-10T17:27:29.009Z"},{"id":4,"email":"m2@test.com","name":"M2","createdAt":"2025-12-11T03:19:19.384Z","updatedAt":"2025-12-11T03:19:19.384Z"}]manish@manubantu:~/code/docker-react-nest-mysql-app$ 
manish@manubantu:~/code/docker-react-nest-mysql-app$ curl -X POST http://localhost:3000/auth/login -H "Content-Type: application/json" -d '{"email":"m1@test.com","password":"changeme"}'
{"id":1,"email":"m1@test.com","name":"Manish","createdAt":"2025-12-10T17:25:47.000Z","updatedAt":"2025-12-10T17:25:47.000Z"}manish@manubantu:~/code/docker-react-nest-mysql-app$ 
manish@manubantu:~/code/docker-react-nest-mysql-app$ curl -X POST http://localhost:3000/users -H "Content-Type: application/json" -d '{"email":"newuser@test.com","name":"New User","password":"mypassword123"}'
{"id":5,"email":"newuser@test.com","name":"New User","createdAt":"2025-12-11T03:30:33.625Z","updatedAt":"2025-12-11T03:30:33.625Z"}manish@manubantu:~/code/docker-react-nest-mysql-app$ 
manish@manubantu:~/code/docker-react-nest-mysql-app$ curl -X POST http://localhost:3000/auth/login -H "Content-Type: application/json" -d '{"email":"newuser@test.com","password":"mypassword123"}'
{"id":5,"email":"newuser@test.com","name":"New User","createdAt":"2025-12-11T03:30:33.625Z","updatedAt":"2025-12-11T03:30:33.625Z"}manish@manubantu:~/code/docker-react-nest-mysql-app$ 
manish@manubantu:~/code/docker-react-nest-mysql-app$ curl -X POST http://localhost:3000/auth/login -H "Content-Type: application/json" -d '{"email":"newuser@test.com","password":"wrongpassword"}'
{"message":"Invalid credentials","error":"Unauthorized","statusCode":401}manish@manubantu:~/code/docker-react-nest-mysql-app$ 
manish@manubantu:~/code/docker-react-nest-mysql-app$ docker ps --filter name=react-frontend-dev
CONTAINER ID   IMAGE                                  COMMAND                  CREATED          STATUS          PORTS                                       NAMES
01640547d297   docker-react-nest-mysql-app-frontend   "docker-entrypoint.s…"   13 minutes ago   Up 12 minutes   0.0.0.0:5173->5173/tcp, :::5173->5173/tcp   react-frontend-dev
manish@manubantu:~/code/docker-react-nest-mysql-app$ 

# password column added 

u@u:~/code/docker-react-nest-mysql-app$ docker exec nestjs-backend-dev npx prisma migrate dev --name add_password_to_user
Error response from daemon: No such container: nestjs-backend-dev
u@u:~/code/docker-react-nest-mysql-app$ 
u@u:~/code/docker-react-nest-mysql-app$ docker ps -a | grep nestjs
u@u:~/code/docker-react-nest-mysql-app$ 
u@u:~/code/docker-react-nest-mysql-app$ docker-compose -f docker-compose.dev.yml up -d --build
WARN[0000] /home/manish/code/docker-react-nest-mysql-app/docker-compose.dev.yml: `version` is obsolete 
[+] Building 106.4s (20/20) FINISHED                             docker:default
 => [backend internal] load build definition from Dockerfile.dev           0.3s
 => => transferring dockerfile: 493B                                       0.0s
 => [frontend internal] load metadata for docker.io/library/node:20-alpin  4.2s
 => [backend auth] library/node:pull token for registry-1.docker.io        0.0s
 => [backend internal] load .dockerignore                                  0.2s
 => => transferring context: 568B                                          0.0s
 => [frontend 1/4] FROM docker.io/library/node:20-alpine@sha256:643e7036a  0.0s
 => [backend internal] load build context                                  0.2s
 => => transferring context: 4.03kB                                        0.0s
 => CACHED [backend 2/7] RUN apk add --no-cache openssl libc6-compat       0.0s
 => CACHED [backend 3/7] WORKDIR /app                                      0.0s
 => CACHED [backend 4/7] COPY package*.json ./                             0.0s
 => [backend 5/7] COPY prisma ./prisma/                                    0.8s
 => [backend 6/7] RUN npm install                                         87.9s
 => [backend 7/7] RUN npx prisma generate                                  3.6s 
 => [backend] exporting to image                                           5.9s 
 => => exporting layers                                                    5.6s 
 => => writing image sha256:ced66df4163097ce2138485d7b5123f51b25783f3137d  0.0s 
 => => naming to docker.io/library/docker-react-nest-mysql-app-backend     0.1s 
 => [frontend internal] load build definition from Dockerfile.dev          0.3s 
 => => transferring dockerfile: 365B                                       0.0s
 => [frontend internal] load .dockerignore                                 0.2s
 => => transferring context: 440B                                          0.0s
 => [frontend internal] load build context                                 0.1s
 => => transferring context: 809B                                          0.0s
 => CACHED [frontend 2/4] WORKDIR /app                                     0.0s
 => CACHED [frontend 3/4] COPY package*.json ./                            0.0s
 => CACHED [frontend 4/4] RUN npm install                                  0.0s
 => [frontend] exporting to image                                          0.1s
 => => exporting layers                                                    0.0s
 => => writing image sha256:6912c8fdfc4f94b9a254bf465f5e7342729b3b449340b  0.0s
 => => naming to docker.io/library/docker-react-nest-mysql-app-frontend    0.0s
[+] Running 3/4
 ✔ Network docker-react-nest-mysql-app_app-network  Created                0.5s 
 ✔ Container mysql-db-dev                           Created                0.9s 
 ✔ Container nestjs-backend-dev                     Created               21.0s 
[+] Running 4/4act-frontend-de[+] Running 3/4     
 ✔ Network docker-react-nest-mysql-app_app-network  Created                                                                                                            0.5s 
 ✔ Container mysql-db-dev                           Healthy                                                                                                          109.2s 
 ✔ Container nestjs-backend-dev                     Started                                                                                                          114.7s 
 ✔ Container react-frontend-dev                     Started                                                                                                           99.6s 
u@u:~/code/docker-react-nest-mysql-app$ 
u@u:~/code/docker-react-nest-mysql-app$ docker exec nestjs-backend-dev npm install bcrypt @types/bcrypt

added 6 packages, changed 19 packages, and audited 703 packages in 27s

139 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
u@u:~/code/docker-react-nest-mysql-app$ 
u@u:~/code/docker-react-nest-mysql-app$ docker exec nestjs-backend-dev npx prisma migrate dev --name add_password_to_user
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": MySQL database "react_nest_app" at "mysql:3306"


Error: 
⚠️ We found changes that cannot be executed:

  • Step 0 Added the required column `password` to the `user` table without a default value. There are 2 rows in this table, it is not possible to execute this step.

You can use prisma migrate dev --create-only to create the migration file, and manually modify it to address the underlying issue(s).
Then run prisma migrate dev to apply it and verify it works.

u@u:~/code/docker-react-nest-mysql-app$ 
u@u:~/code/docker-react-nest-mysql-app$ docker exec nestjs-backend-dev npx prisma migrate dev --create-only --name add_password_to_user
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": MySQL database "react_nest_app" at "mysql:3306"



⚠️ We found changes that cannot be executed:

  • Step 0 Added the required column `password` to the `user` table without a default value. There are 2 rows in this table, it is not possible to execute this step.

y
Prisma Migrate created the following migration without applying it 20251211030636_add_password_to_user

You can now edit it and apply it by running prisma migrate dev.
┌─────────────────────────────────────────────────────────┐
│  Update available 5.22.0 -> 7.1.0                       │
│                                                         │
│  This is a major update - please follow the guide at    │
│  https://pris.ly/d/major-version-upgrade                │
│                                                         │
│  Run the following to update                            │
│    npm i --save-dev prisma@latest                       │
│    npm i @prisma/client@latest                          │
└─────────────────────────────────────────────────────────┘
u@u:~/code/docker-react-nest-mysql-app$ y

ls -la prisma/migrations/ | tail -5
y: command not found
u@u:~/code/docker-react-nest-mysql-app$ 
u@u:~/code/docker-react-nest-mysql-app$ ls -la prisma/migrations/ | tail -5
drwxrwxr-x 3 manish manish 4096 Dec  2 10:47 ..
drwxrwxr-x 2 manish manish 4096 Dec  2 10:47 20251202051746_init
drwxrwxr-x 2 manish manish 4096 Dec  2 13:38 20251202080856_init
drwxr-xr-x 2 root   root   4096 Dec 11 08:36 20251211030636_add_password_to_user
-rw-rw-r-- 1 manish manish  121 Dec 11 08:36 migration_lock.toml
u@u:~/code/docker-react-nest-mysql-app$ 
u@u:~/code/docker-react-nest-mysql-app$ docker exec nestjs-backend-dev node -e "const bcrypt = require('bcrypt'); bcrypt.hash('changeme', 10).then(hash => console.log(hash));"
$2b$10$fMfd4vVyEDFOsYCjFPGS3e5LFVtpRTyBK9Q1JFOPouZ13b.gjP7JO
u@u:~/code/docker-react-nest-mysql-app$ 
u@u:~/code/docker-react-nest-mysql-app$ docker exec nestjs-backend-dev npx prisma migrate deploy
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": MySQL database "react_nest_app" at "mysql:3306"

3 migrations found in prisma/migrations

Applying migration `20251211030636_add_password_to_user`

The following migration(s) have been applied:

migrations/
  └─ 20251211030636_add_password_to_user/
    └─ migration.sql
      
All migrations have been successfully applied.
u@u:~/code/docker-react-nest-mysql-app$ 
u@u:~/code/docker-react-nest-mysql-app$ docker exec nestjs-backend-dev npx prisma generate
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

✔ Generated Prisma Client (v5.22.0) to ./node_modules/@prisma/client in 1.29s

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Curious about the SQL queries Prisma ORM generates? Optimize helps you enhance your visibility: https://pris.ly/tip-2-optimize

u@u:~/code/docker-react-nest-mysql-app$ 

